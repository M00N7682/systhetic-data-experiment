# Tail-Conditional KS Distance: 보험 합성 데이터의 조건부 극단 손실 보존 평가 지표

---

## 요약 (Abstract)

합성 데이터는 개인정보 보호와 데이터 활용 사이의 균형을 제공하는 유망한 대안으로 주목받고 있다. 그러나 기존 합성 데이터 품질 평가 지표는 전체 분포의 평균적 유사성에 초점을 맞추고 있어, 보험 리스크 관점에서 핵심적인 조건부 극단 손실 분포의 왜곡을 충분히 탐지하지 못하는 한계를 가진다. 본 연구는 Kolmogorov-Smirnov Distance를 조건부 분포 및 극단 손실 영역으로 확장한 **Tail-Conditional KS Distance (T-cKS)**를 제안한다. Allstate Claims Severity 데이터셋을 활용한 통제된 실험 결과, 조건부 극단 손실이 80% 축소된 상황에서 기존 지표(mKS, cKS)는 KS=0.017 수준으로 왜곡을 거의 탐지하지 못한 반면, 제안하는 T-cKS는 KS=0.344로 **약 20배 높은 민감도**를 보였다. 이는 T-cKS가 보험 합성 데이터의 리스크 관점 품질 평가에 효과적임을 시사한다.

**키워드**: 합성 데이터, 품질 평가, Kolmogorov-Smirnov Distance, 극단값, 보험 리스크, 조건부 분포

---

## 1. 서론

### 1.1 연구 배경 및 필요성

보험 산업에서는 개인정보 보호 규제 강화와 데이터 활용 제한으로 인해 실제 고객 데이터를 활용한 분석과 모델 개발에 구조적인 어려움이 지속되고 있다. 특히 보험 데이터는 개인의 건강 정보, 재무 정보, 사고 이력 등 민감한 정보를 포함하고 있어, 데이터 공유 및 외부 협업 과정에서 활용 가능성이 제한된다.

이러한 환경에서 합성 데이터(synthetic data)가 유망한 대안으로 주목받고 있다. 합성 데이터는 실제 데이터의 통계적 특성을 모사하여 생성된 인공 데이터로, 개인정보 보호를 유지하면서도 분석, 모델 학습, 시스템 테스트 등의 목적에 활용될 수 있다.

그러나 합성 데이터의 활용 가능성이 확대됨에 따라, **생성된 데이터가 실제 보험 리스크를 얼마나 충실히 반영하는지를 평가하는 문제**의 중요성이 증가하고 있다. 합성 데이터가 실제 데이터와 유사해 보이더라도, 보험 리스크 관점에서 중요한 정보가 손실되거나 왜곡될 경우, 해당 데이터를 기반으로 한 분석 결과는 실무적으로 유의미하지 않을 수 있다.

### 1.2 연구 문제 정의

기존 합성 데이터 품질 평가는 주로 Kolmogorov-Smirnov(KS) Distance와 같은 통계적 거리 지표를 활용하여 전반적인 분포 유사성을 측정하는 방식에 기반하고 있다.

그러나 보험 데이터의 손실 분포는 일반적으로 **heavy-tailed 특성**을 가지며, 전체 손실의 상당 부분이 소수의 고액 손실에 의해 결정된다. 특히 이러한 고액 손실은 특정 조건(예: 고위험 계약군) 하에서 집중적으로 발생하는 경향을 보인다. 그럼에도 불구하고 기존 평가지표는 전체 분포의 평균적 유사성에 초점을 두고 있어, **특정 조건 하에서 발생하는 극단 손실 분포의 왜곡을 명시적으로 평가하지 못하는 한계**를 가진다.

이에 본 연구는 다음과 같은 연구 질문을 제기한다:

> **"합성 데이터 평가 지표는 보험 리스크 관점에서 중요한 조건부 극단 손실 분포의 왜곡을 효과적으로 탐지할 수 있는가?"**

### 1.3 연구 목적 및 기여점

본 연구의 목적은 기존 분포 중심 평가지표의 한계를 분석하고, 보험 리스크의 핵심 요소인 **조건부 극단 손실 분포 보존 여부**를 평가할 수 있는 새로운 평가 지표를 제안하는 데 있다.

본 연구의 기여점은 다음과 같다:

1. **문제 재정의**: 보험 합성 데이터 평가 문제를 평균적 분포 유사성이 아닌, 조건부 극단 손실 보존이라는 리스크 중심 관점에서 재정의
2. **새로운 지표 제안**: 기존 KS Distance를 조건부 분포 및 극단 손실 영역으로 확장한 Tail-Conditional KS Distance (T-cKS) 제안
3. **실증적 검증**: 통제된 실험을 통해 제안 지표의 탐지 능력을 기존 지표 대비 약 20배 높은 것으로 확인

---

## 2. 이론적 배경

### 2.1 기존 평가지표의 한계

#### 2.1.1 Marginal KS Distance (mKS)

Marginal KS Distance는 두 분포의 누적분포함수(CDF) 간 최대 차이를 측정한다:

$$\text{mKS} = \sup_y |F_{\text{real}}(y) - F_{\text{synth}}(y)|$$

이 지표는 분포 전체를 단일 값으로 요약하므로, **특정 구간에서 발생하는 구조적 차이가 희석**될 수 있다.

#### 2.1.2 Conditional KS Distance (cKS)

Conditional KS Distance는 조건 변수 $Z$의 각 값에 대해 KS Distance를 계산하고 가중 평균한다:

$$\text{cKS} = \sum_{z} w_z \cdot \text{KS}(Y_{\text{real}}|Z=z, Y_{\text{synth}}|Z=z)$$

여기서 $w_z$는 조건 $z$의 샘플 비율이다. 그러나 이 방식도 **조건별 전체 분포를 비교**하므로, 극단 손실 영역의 왜곡이 비극단 영역에 의해 희석된다.

### 2.2 제안 지표: Tail-Conditional KS Distance (T-cKS)

본 연구는 다음과 같이 T-cKS를 정의한다:

#### Step 1: Tail Threshold 정의
실제 데이터 기준으로 tail threshold를 정의한다:
$$\tau_q = Q_q(Y_{\text{real}})$$

여기서 $Q_q$는 $q$-분위수 함수이다 (예: $q = 0.95$).

#### Step 2: Tail Subset 필터링
각 조건 $z$에 대해 tail subset을 정의한다:
$$Y_{\text{tail}}^z = \{y \in Y | Z = z \land y > \tau_q\}$$

**중요**: 합성 데이터에도 **동일한 $\tau_q$**를 적용한다.

#### Step 3: Tail-Conditional KS 계산
각 조건에서 tail 분포 간 KS Distance를 계산한다:
$$\text{T-KS}_z = \text{KS}(Y_{\text{real,tail}}^z, Y_{\text{synth,tail}}^z)$$

#### Step 4: 가중 평균
Tail 샘플 수로 가중 평균한다:
$$\text{T-cKS} = \sum_{z} \frac{n_{\text{tail}}^z}{\sum_z n_{\text{tail}}^z} \cdot \text{T-KS}_z$$

---

## 3. 실험 설계

### 3.1 실험 목적

본 실험의 목적은 **평가 지표의 탐지 능력 검증**이며, 합성 데이터 생성 모델의 성능 비교는 목적에 포함되지 않는다. 구체적으로:

1. 기존 지표(mKS, cKS)가 조건부 극단 손실 왜곡을 탐지하지 못하는 상황을 정의
2. 제안한 T-cKS가 이러한 실패 모드를 탐지할 수 있는지 검증

### 3.2 데이터셋

**Allstate Claims Severity Dataset** (Kaggle)을 사용하였다.

| 항목 | 값 |
|------|-----|
| 총 샘플 수 | 188,318 |
| 손실 변수 (Y) | `loss` (연속형) |
| 조건 변수 (Z) | `cat79` (4개 범주: A, B, C, D) |

#### 손실 분포 특성

| 통계량 | 값 |
|--------|-----|
| 평균 | 3,037.34 |
| 중앙값 | 2,115.57 |
| 표준편차 | 2,904.09 |
| 왜도 (Skewness) | 3.79 |
| 첨도 (Kurtosis) | 48.08 |
| 95% 분위수 | 8,508.54 |
| 최대값 | 121,012.25 |

왜도 > 1, 첨도 > 3으로 **heavy-tailed 분포**임을 확인하였다.

#### 조건별 분포 특성

| 조건 (cat79) | 샘플 수 | 평균 손실 | Tail 샘플 (q=0.95) |
|--------------|---------|-----------|-------------------|
| A | 7,064 | 2,718 | 240 |
| B | 152,929 | 2,470 | 2,905 |
| C | 1,668 | 4,087 | 130 |
| **D** | **26,657** | **6,312** | **6,141** |

조건 D는 평균 손실이 가장 높고, tail 영역 샘플도 가장 많아 **고위험군**으로 해석할 수 있다.

### 3.3 Failure Mode 설계

#### 핵심 시나리오
> "전체 분포는 유사하게 유지되면서, **특정 조건(D)의 극단 손실만 축소**된 상황"

이는 합성 데이터 생성 과정에서 고위험군의 극단 손실이 과소 생성되는 실패 모드를 모사한다.

#### 왜곡 방법: Tail Scaling

조건 D의 tail 값을 다음과 같이 스케일링한다:
$$Y_{\text{new}} = \tau_q + (Y - \tau_q) \times \text{scale\_factor}$$

- `scale_factor = 1.0`: 원본 (왜곡 없음)
- `scale_factor = 0.2`: tail의 80% 축소 (극단성 대폭 감소)

이 방식의 장점:
1. **Tail 샘플 수 유지**: 기존 winsorization과 달리 tail 영역의 샘플 수가 보존됨
2. **분포 형태만 변경**: 전체 분포는 거의 유지되면서 tail의 극단성만 감소
3. **현실적 시나리오**: 합성 데이터 생성 모델이 극단값을 과소 생성하는 상황을 모사

### 3.4 평가 지표

| 지표 | 정의 | 비교 대상 |
|------|------|----------|
| mKS | 전체 Y 분포 비교 | 전체 |
| cKS | 조건별 전체 Y 분포 비교 후 가중 평균 | 조건별 전체 |
| T-cKS | 조건별 tail Y 분포 비교 후 가중 평균 | 조건별 tail |
| T-cKS(D) | 조건 D의 tail 분포만 비교 | 왜곡 조건만 |

---

## 4. 실험 결과

### 4.1 주요 결과

**표 1. Tail Scaling 강도별 평가 지표 비교 (q=0.95, 왜곡 대상: 조건 D)**

| Scale Factor | mKS | cKS | T-cKS | T-cKS(D) |
|--------------|-----|-----|-------|----------|
| 1.0 (원본) | 0.0000 | 0.0000 | 0.0001 | 0.0002 |
| 0.8 (20% 축소) | 0.0028 | 0.0028 | 0.0562 | 0.0861 |
| 0.6 (40% 축소) | 0.0061 | 0.0061 | 0.1221 | 0.1873 |
| 0.4 (60% 축소) | 0.0106 | 0.0106 | 0.2120 | 0.3250 |
| **0.2 (80% 축소)** | **0.0172** | **0.0172** | **0.3441** | **0.5276** |

### 4.2 결과 분석

#### 4.2.1 기존 지표의 한계

조건 D의 극단 손실이 80% 축소된 상황(scale=0.2)에서:

- **mKS = 0.0172**: 전체 분포 관점에서는 거의 차이 없음
- **cKS = 0.0172**: 조건별로 분리해도 전체 분포 비교이므로 여전히 낮음

이는 조건 D의 tail이 전체 데이터의 약 3.3%에 불과하여, 전체 분포 관점에서는 왜곡이 희석되기 때문이다.

#### 4.2.2 T-cKS의 탐지 능력

동일 상황에서:

- **T-cKS = 0.3441**: 전체 tail 기준으로도 유의미한 차이 탐지
- **T-cKS(D) = 0.5276**: 왜곡 조건만 보면 극명한 차이

#### 4.2.3 탐지력 비교

$$\frac{\text{T-cKS}}{\text{cKS}} = \frac{0.3441}{0.0172} \approx \textbf{20배}$$

T-cKS는 기존 cKS 대비 **약 20배 높은 민감도**로 조건부 극단 손실 왜곡을 탐지하였다.

### 4.3 시각적 분석

**그림 1. 왜곡 강도에 따른 평가 지표 변화**

```
KS Distance
     │
0.35 ┤                                    ●─── T-cKS
     │                              ●
0.30 ┤                        
     │                        ●
0.25 ┤                  
     │                  ●
0.20 ┤            
     │            ●
0.15 ┤      
     │      ●
0.10 ┤
     │●
0.05 ┤──────────────────────────────────── mKS, cKS
     │
0.00 ┼────┬────┬────┬────┬────┬────────►
         1.0  0.8  0.6  0.4  0.2    Scale Factor
              (왜곡 강도 증가 →)
```

mKS와 cKS는 왜곡 강도가 증가해도 거의 변화가 없는 반면, T-cKS는 왜곡 강도에 비례하여 증가함을 확인할 수 있다.

---

## 5. 논의

### 5.1 연구 의의

본 연구는 보험 합성 데이터 평가 문제를 **리스크 중심 관점**에서 재정의하고, 이에 적합한 평가 지표를 제안하였다.

기존 평가 방식의 근본적 한계는 **"평균적으로 유사하면 좋은 합성 데이터"**라는 암묵적 가정에 있다. 그러나 보험 리스크 관리에서 중요한 것은 평균이 아닌 **극단 손실**이며, 특히 **특정 조건 하에서의 극단 손실**이다.

제안하는 T-cKS는 이러한 리스크 관점을 평가 지표에 명시적으로 반영함으로써, 기존 지표가 탐지하지 못하는 **실패 모드를 효과적으로 식별**할 수 있음을 실증하였다.

### 5.2 실무적 시사점

1. **합성 데이터 품질 검증**: 합성 데이터 도입 전 T-cKS를 통해 리스크 관점의 품질 검증 가능
2. **생성 모델 개선**: T-cKS가 높은 경우, 극단 손실 영역의 모델링 개선 필요성 진단
3. **리스크 모델 신뢰성**: T-cKS 기반 검증을 통과한 합성 데이터로 학습된 리스크 모델의 신뢰성 제고

### 5.3 한계점 및 향후 연구

1. **Tail Threshold 선택**: q 값 선택에 대한 가이드라인 필요
2. **다변량 확장**: 현재는 단변량 손실에 초점, 다변량 극단 의존성 평가로 확장 가능
3. **실제 합성 데이터 검증**: 본 연구는 통제된 실패 모드 기반 실험으로, 실제 생성 모델 출력물에 대한 추가 검증 필요

---

## 6. 결론

본 연구는 보험 합성 데이터 평가에서 기존 분포 기반 지표의 한계를 분석하고, 조건부 극단 손실 보존을 평가하는 **Tail-Conditional KS Distance (T-cKS)**를 제안하였다.

실험 결과, 조건부 극단 손실이 80% 축소된 상황에서:
- 기존 지표(mKS, cKS)는 KS = 0.017 수준으로 왜곡을 거의 탐지하지 못함
- 제안하는 T-cKS는 KS = 0.344로 **약 20배 높은 민감도**를 보임

이는 T-cKS가 보험 합성 데이터의 리스크 관점 품질 평가에 효과적인 도구임을 시사한다. 향후 실제 합성 데이터 생성 모델에 대한 적용 및 다변량 확장 연구가 필요하다.

---

## 참고문헌

1. Kolmogorov, A. N. (1933). Sulla determinazione empirica di una legge di distribuzione. *Giornale dell'Istituto Italiano degli Attuari*, 4, 83-91.

2. Smirnov, N. (1948). Table for estimating the goodness of fit of empirical distributions. *Annals of Mathematical Statistics*, 19(2), 279-281.

3. Embrechts, P., Klüppelberg, C., & Mikosch, T. (1997). *Modelling Extremal Events for Insurance and Finance*. Springer.

4. Jorion, P. (2007). *Value at Risk: The New Benchmark for Managing Financial Risk*. McGraw-Hill.

5. Allstate. (2016). Allstate Claims Severity. Kaggle Competition. https://www.kaggle.com/c/allstate-claims-severity

---

## 부록

### A. 실험 환경

- Python 3.14
- NumPy 2.4.0
- Pandas 2.3.3
- SciPy 1.16.3

### B. 재현 코드

실험 코드는 다음 저장소에서 확인할 수 있다:
https://github.com/M00N7682/systhetic-data-experiment

### C. 조건별 상세 결과

**표 C1. 조건별 KS Distance 상세 (scale=0.2)**

| 조건 | Conditional KS | Tail-Conditional KS |
|------|----------------|---------------------|
| A | 0.0000 | 0.0000 |
| B | 0.0000 | 0.0000 |
| C | 0.0000 | 0.0000 |
| **D (왜곡)** | **0.1843** | **0.5276** |
| **가중 평균** | **0.0172** | **0.3441** |

조건 D만 왜곡되었음에도 전체 가중 평균에서는 희석되어 cKS=0.0172로 나타났으나, T-cKS는 tail 영역에 집중하여 T-cKS=0.3441로 왜곡을 효과적으로 탐지하였다.

